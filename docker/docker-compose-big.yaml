version: '3'
services:
  h1:
    image: scapy
    container_name: h1
    cap_add:
      - NET_ADMIN
    privileged: true
    command: /home/p4/pot/docker/run.sh host 1
    networks:
      h1_net:
        ipv4_address: 10.1.1.3
    volumes:
      - ../:/home/p4/pot



  ingressNode:
    image: p4custom-java
    container_name: ingressNode
    cap_add:
      - NET_ADMIN
    privileged: true
    command: /home/p4/pot/docker/run.sh 11
    networks:
      h1_net:
        ipv4_address: 10.1.1.2
      ingress_net:
        ipv4_address: 10.0.1.3
      controller:
        ipv4_address: 10.0.0.11
    volumes:
      - ../:/home/p4/pot

  egressNode:
    image: p4custom-java
    container_name: egressNode
    cap_add:
      - NET_ADMIN
    privileged: true
    command: /home/p4/pot/docker/run.sh 15
    networks:
      zegress_net:
        ipv4_address: 10.0.4.2
      zh2_net:
        ipv4_address: 10.1.2.2
      controller:
        ipv4_address: 10.0.0.15
    volumes:
      - ../:/home/p4/pot

  h2:
    image: scapy
    container_name: h2
    cap_add:
      - NET_ADMIN
    privileged: true
    command: /home/p4/pot/docker/run.sh host 2
    networks:
      zh2_net:
        ipv4_address: 10.1.2.3
    volumes:
      - ../:/home/p4/pot

  controller:
    image: p4custom-kafka
    container_name: controller
    cap_add:
      - NET_ADMIN
    privileged: true
    command: /home/p4/pot/docker/run.sh controller 5
    networks:
      controller:
        ipv4_address: 10.0.0.10
      kafka-net:
        ipv4_address: 10.2.1.10
    volumes:
      - ../:/home/p4/pot

  middleNode1:
          image: p4custom-kafka
          container_name: middleNode1
          cap_add:
            - NET_ADMIN
          privileged: true
          command: /home/p4/pot/docker/run.sh 12
          networks:
            ingress_net:
              ipv4_address: 10.0.1.2  # Unique IP for each node
            controller:
              ipv4_address: 10.0.0.12
            middle1_middle4_net:
              ipv4_address: 10.0.2.3
          volumes:
            - ../:/home/p4/pot
      
  middleNode2:
        image: p4custom-kafka
        container_name: middleNode2
        cap_add:
          - NET_ADMIN
        privileged: true
        command: /home/p4/pot/docker/run.sh 13 script
        networks:
          middle2_middle6_net:
            ipv4_address: 10.0.7.2
          controller:
            ipv4_address: 10.0.0.13
          middle2_middle3_net:
            ipv4_address: 10.0.3.3
        volumes:
          - ../:/home/p4/pot
    
  middleNode3:
        image: p4custom-kafka
        container_name: middleNode3
        cap_add:
          - NET_ADMIN
        privileged: true
        command: /home/p4/pot/docker/run.sh 14 
        networks:
          middle2_middle3_net:
            ipv4_address: 10.0.3.2
          zegress_net:
            ipv4_address: 10.0.4.3
          controller:
            ipv4_address: 10.0.0.14
        volumes:
          - ../:/home/p4/pot
    
  middleNoPoT4:
    image: p4custom-kafka
    container_name: middleNoPoT4
    cap_add:
      - NET_ADMIN
    privileged: true
    command: /home/p4/pot/docker/run.sh noPoT 4 first
    networks:
      middle1_middle4_net:
        ipv4_address: 10.0.2.4
      middle4_middle5_net:
        ipv4_address: 10.0.5.4
    volumes:
      - ../:/home/p4/pot

  middleNoPoT5:
    image: p4custom-kafka
    container_name: middleNoPoT5
    cap_add:
      - NET_ADMIN
    privileged: true
    command: /home/p4/pot/docker/run.sh noPoT 5 
    networks:
      middle4_middle5_net:
        ipv4_address: 10.0.5.2
      middle5_middle6_net:
        ipv4_address: 10.0.6.4
    volumes:
      - ../:/home/p4/pot

  middleNoPoT6:
    image: p4custom-kafka
    container_name: middleNoPoT6
    cap_add:
      - NET_ADMIN
    privileged: true
    command: /home/p4/pot/docker/run.sh noPoT 6
    networks:
      middle2_middle6_net:
        ipv4_address: 10.0.7.3
      middle5_middle6_net:
        ipv4_address: 10.0.6.2
    volumes:
      - ../:/home/p4/pot

networks:
  h1_net:
    driver: bridge
    ipam:
      driver: default
      config:
        - subnet: 10.1.1.0/24

  ingress_net:
    driver: bridge
    ipam:
      driver: default
      config:
        - subnet: 10.0.1.0/24

  zegress_net:
    driver: bridge
    ipam:
      driver: default
      config:
        - subnet: 10.0.4.0/24

  zh2_net:
    driver: bridge
    ipam:
      driver: default
      config:
        - subnet: 10.1.2.0/24

  controller:
    driver: bridge
    ipam:
      driver: default
      config:
        - subnet: 10.0.0.0/24

  kafka-net:
    external: true

  middle1_middle4_net:
    driver: bridge
    ipam:
      driver: default
      config:
        - subnet: 10.0.2.0/24

  middle2_middle3_net:
    driver: bridge
    ipam: 
      driver: default
      config:
        - subnet: 10.0.3.0/24

  middle4_middle5_net:
      driver: bridge
      ipam:
        driver: default
        config:
          - subnet: 10.0.5.0/24
  
  middle5_middle6_net:
      driver: bridge
      ipam:
        driver: default
        config:
          - subnet: 10.0.6.0/24
  
  middle2_middle6_net:
      driver: bridge
      ipam:
        driver: default
        config:
          - subnet: 10.0.7.0/24
  
